version: '3.1'

services:
  spring:
    build:
      context: backend/.
      dockerfile: Dockerfile
    ports:
      - 8091:8080
    environment:
      - DB_HOST=mongo
      - DB_USER=root
      - DB_PASSWORD=example
      - PROJECT_ENV=prod
      - PROJECT_HOST_DIR=G:/projects
      - PROJECT_DIR=/projects
      - CONTAINER_MANAGER_HOST=manager
      - CONTAINER_MANAGER_PORT=80
    volumes:
      - project_volume:/projects
  mongo:
    image: mongo:4.4
    restart: always
    ports:
      - 27017:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: example

  mongo-express:
    image: mongo-express
    restart: always
    ports:
      - 8081:8081
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: root
      ME_CONFIG_MONGODB_ADMINPASSWORD: example
  manager:
    build:
      context: container-manager/.
      dockerfile: Dockerfile
    expose:
      - 80
    volumes:
      - ./container-manager/src:/app
      - //var/run/docker.sock:/var/run/docker.sock
      - project_volume:/projects # This needs to be a volume later on
volumes:
   project_volume:
     driver: local
     driver_opts:
       type: none
       device: G:/projects
       o: bind